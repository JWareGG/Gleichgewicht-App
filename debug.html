<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Debugging</title>
</head>
<body>
    <h1>Debugging-Log</h1>
    <pre id="log"></pre>

    <script>
        function logMessage(message) {
            document.getElementById("log").textContent += message + "\n";
        }

        logMessage("ğŸ“¢ Debugging gestartet!");

        // PrÃ¼ft, ob der Service Worker registriert ist
        navigator.serviceWorker.getRegistration().then(reg => {
            if (reg) {
                logMessage("âœ… Service Worker aktiv: " + JSON.stringify(reg));

                // ÃœberprÃ¼ft, ob ein Update fÃ¼r den Service Worker gefunden wird
                reg.addEventListener("updatefound", () => {
                    logMessage("ğŸ”„ Service Worker Update gefunden!");
                });

            } else {
                logMessage("âŒ Kein Service Worker gefunden!");
            }
        });

        // PrÃ¼ft, ob die Seite Ã¼ber HTTPS lÃ¤uft (erforderlich fÃ¼r Service Worker)
        logMessage("ğŸ”’ Ist HTTPS aktiv? " + location.protocol);

        // Zeigt den aktuellen Cache-Inhalt an
        caches.keys().then(keys => logMessage("ğŸ“‚ Cache Inhalte: " + keys.join(", ")));

        // Falls kein Service Worker registriert ist, registriere ihn jetzt!
        navigator.serviceWorker.register("sw.js")
            .then(reg => logMessage("âœ… Service Worker erfolgreich registriert: " + JSON.stringify(reg)))
            .catch(error => logMessage("âŒ Fehler beim Registrieren: " + error));

        // PrÃ¼ft, ob der Service Worker bereit ist
        navigator.serviceWorker.ready.then(reg => {
            logMessage("ğŸš€ Service Worker ist jetzt aktiv und bereit!");
        }).catch(error => {
            logMessage("âŒ Fehler: Service Worker ist NICHT bereit! " + error);
        });

        // Funktion zum Testen von Benachrichtigungen
        function testNotification() {
            if ("Notification" in window && Notification.permission === "granted") {
                navigator.serviceWorker.ready.then(reg => {
                    reg.showNotification("ğŸ”” Test-Erinnerung!", {
                        body: "Dies ist eine Test-Benachrichtigung vom Service Worker.",
                        icon: "icon-192x192.png"
                    });
                    logMessage("âœ… Test-Erinnerung wurde gesendet!");
                }).catch(error => {
                    logMessage("âŒ Fehler beim Senden der Test-Erinnerung: " + error);
                });
            } else {
                logMessage("âŒ Benachrichtigungen sind blockiert oder nicht erlaubt!");
            }
        }
    </script>

    <button onclick="testNotification()">ğŸ”” Test-Erinnerung senden</button>
</body>
</html>